<p style="color: green"><%= notice %></p>
<!-- 3D Workout Visualization - Full Screen -->
<div class="workout-3d-fullscreen">
  <div
    data-controller="three-workout"
    data-three-workout-workout-data-value="<%= @workout.as_json(include_waypoints: true).to_json %>"
    data-three-workout-waypoints-value="<%= @workout.waypoints.map(&:to_h).to_json %>"
    class="three-container">
    <canvas
      data-three-workout-target="canvas"
      class="three-canvas">
    </canvas>
    <!-- Workout Details Overlay -->
    <div class="workout-details-overlay" data-controller="collapsible">
      <div class="overlay-header">
        <h2>Workout Details</h2>
        <button class="toggle-btn" data-action="click->collapsible#toggle" data-collapsible-target="toggle">
          <span class="toggle-icon">âˆ’</span>
        </button>
      </div>

      <div class="overlay-content" data-collapsible-target="content">
        <div class="workout-info">
          <div class="workout-stats">
            <div class="stat">
              <span class="label">Date:</span>
              <span class="value"><%= @workout.start_time.strftime('%-m/%-d/%y @%-I:%M%P') %></span>
            </div>
            <div class="stat">
              <span class="label">Duration:</span>
              <span class="value"><%= Time.at(@workout.duration).utc.strftime('%-Hh:%Mm:%Ss') %></span>
            </div>
            <div class="stat">
              <span class="label">Distance:</span>
              <span class="value"><%= @workout.distance %></span>
            </div>
            <div class="stat">
              <span class="label">Avg Speed:</span>
              <span class="value"><%= @workout.average_speed.round(1) %> m/s</span>
            </div>
            <div class="stat">
              <span class="label">Max Speed:</span>
              <span class="value"><%= @workout.max_speed.round(1) %> m/s</span>
            </div>
          </div>
        </div>

        <div class="workout-controls">
          <%= link_to "Edit", edit_workout_path(@workout), class: "btn btn-edit" %>
          <%= link_to "Back to Workouts", workouts_path, class: "btn btn-back" %>
          <%= button_to "Delete", @workout, method: :delete, class: "btn btn-delete", data: { confirm: 'Are you sure?' } %>
        </div>
      </div>
    </div>
    <!-- 3D Controls Overlay -->
    <div class="controls-overlay">
      <div>ðŸŽ® <strong>3D Controls:</strong></div>
      <div>â€¢ Drag to rotate view</div>
      <div>â€¢ Scroll to zoom</div>
      <div>â€¢ Green sphere = Start</div>
      <div>â€¢ Red sphere = End</div>
      <div>â€¢ Line color = Speed (green=slow, red=fast)</div>
    </div>

  </div>

  <!-- Map Projection Controls Overlay -->
  <div class="projection-controls-overlay" data-controller="collapsible projection-controls" data-projection-controls-debug="true">
    <div class="overlay-header">
      <h3>Map Projection Controls</h3>
      <button class="toggle-btn" data-action="click->collapsible#toggle" data-collapsible-target="toggle">
        <span class="toggle-icon">âˆ’</span>
      </button>
    </div>

    <div class="overlay-content" data-collapsible-target="content">
      <div class="control-group">
        <h4>Scale Factors</h4>
        <div class="control-row">
          <label>Lat Scale:</label>
          <input type="range" min="0.1" max="3.0" step="0.1" value="1.0"
                 data-action="input->projection-controls#updateLatScale"
                 data-projection-controls-target="latScale">
          <span data-projection-controls-target="latScaleValue">1.0</span>
        </div>
        <div class="control-row">
          <label>Lng Scale:</label>
          <input type="range" min="0.1" max="3.0" step="0.1" value="1.0"
                 data-action="input->projection-controls#updateLngScale"
                 data-projection-controls-target="lngScale">
          <span data-projection-controls-target="lngScaleValue">1.0</span>
        </div>
      </div>

      <div class="control-group">
        <h4>Rotation</h4>
        <div class="control-row">
          <label>Rotation (deg):</label>
          <input type="range" min="-180" max="180" step="5" value="0"
                 data-action="input->projection-controls#updateRotation"
                 data-projection-controls-target="rotation">
          <span data-projection-controls-target="rotationValue">0Â°</span>
        </div>
      </div>

      <div class="control-group">
        <h4>Offsets</h4>
        <div class="control-row">
          <label>Lat Offset:</label>
          <input type="range" min="-0.01" max="0.01" step="0.0001" value="0"
                 data-action="input->projection-controls#updateLatOffset"
                 data-projection-controls-target="latOffset">
          <span data-projection-controls-target="latOffsetValue">0</span>
        </div>
        <div class="control-row">
          <label>Lng Offset:</label>
          <input type="range" min="-0.01" max="0.01" step="0.0001" value="0"
                 data-action="input->projection-controls#updateLngOffset"
                 data-projection-controls-target="lngOffset">
          <span data-projection-controls-target="lngOffsetValue">0</span>
        </div>
      </div>

      <div class="control-group">
        <h4>Axis Control</h4>
        <div class="control-row">
          <label>Flip X:</label>
          <input type="checkbox" data-action="change->projection-controls#updateFlipX"
                 data-projection-controls-target="flipX">
        </div>
        <div class="control-row">
          <label>Flip Z:</label>
          <input type="checkbox" checked data-action="change->projection-controls#updateFlipZ"
                 data-projection-controls-target="flipZ">
        </div>
        <div class="control-row">
          <label>Swap Axes:</label>
          <input type="checkbox" data-action="change->projection-controls#updateSwapAxes"
                 data-projection-controls-target="swapAxes">
        </div>
      </div>

      <div class="control-group">
        <h4>Elevation</h4>
        <div class="control-row">
          <label>Elevation Scale:</label>
          <input type="range" min="0.01" max="1.0" step="0.01" value="0.1"
                 data-action="input->projection-controls#updateElevationScale"
                 data-projection-controls-target="elevationScale">
          <span data-projection-controls-target="elevationScaleValue">0.1</span>
        </div>
      </div>

      <div class="control-actions">
        <button class="btn btn-reset" data-action="click->projection-controls#resetToDefaults">Reset to Defaults</button>
        <button class="btn btn-apply" data-action="click->projection-controls#applyChanges">Apply Changes</button>
      </div>
    </div>
  </div>
</div>
