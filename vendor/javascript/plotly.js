import t from"https";import e from"http";import r from"url";import o from"buffer";var s={200:"healthy endpoint disconnect",308:"stream had ended",400:"invalid or malformed request syntax",403:"stream token no longer associated with this plot",404:"streamtoken not registered or valid",405:"bad request method: use POST for streaming",406:"bad request header: missing 'plotly-streamtoken'",408:"timeout on active data",422:"json parse error: please stream newline seperated JSON",423:"connection limit associated with this token has been reached",449:"stream content has changed, reloading clients",500:"internal server error",503:"internal database error",520:"error in request stream"};var n={};var a=o.Buffer;var i=t;var l=e;var p=s;var u=r;n=Plotly;function Plotly(t,e){if(!(this instanceof Plotly))return new Plotly(t,e);var r={};if("object"===typeof t){r=t;this.username=r.username;this.apiKey=r.apiKey;this.host=r.host||"plot.ly";this.port=r.port||443}else{this.username=t;this.apiKey=e;this.host="plot.ly";this.port=443}this.streamHost="";this.version="1.0.4";this.platform="nodejs";this.origin="plot"}Plotly.prototype.plot=function(t,e,r){var o=this;r||(r=function(){});Array.isArray(t)||(t=[t]);var s="";var n={platform:o.platform,version:o.version,args:JSON.stringify(t),kwargs:JSON.stringify(e),un:o.username,key:o.apiKey,origin:o.origin};for(var l in n)s+=l+"="+n[l]+"&";s=new a(s.substring(0,s.length-1),"utf8");var p={host:o.host,port:o.port,path:"/clientresp",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":s.length},withCredentials:false};var h=i.request(p,(function(t){parseRes(t,(function(e,s){try{s=JSON.parse(s)}catch(t){r(t)}void 0!=s["stream-status"]&&(o.streamHost=u.parse(s["stream-host"]).hostname);if(s.error.length>0){var n=new Error(s.error);n.body=s;n.statusCode=t.statusCode;r(n)}else r(null,{streamstatus:s["stream-status"],url:s.url,message:s.message,warning:s.warning,filename:s.filename,error:s.error})}))}));h.on("error",(function(t){r(t)}));h.write(s);h.end()};Plotly.prototype.stream=function(t,e){var r=this;var o={};if("object"===typeof t){o=t;t=o.token;var s=o.streamHost||r.streamHost;var n=o.port||80}var a={host:s||r.streamHost||"stream.plot.ly",port:n||80,path:"/",method:"POST",agent:false,headers:{"plotly-streamtoken":t}};e||(e=function(){});var i=l.request(a,(function(t){var r=p[t.statusCode];if(200!==t.statusCode){var o=new Error(r);o.statusCode=t.statusCode;e(o)}else e(null,{msg:r,statusCode:t.statusCode})}));i.on("error",(function(t){e(t)}));i.setTimeout&&i.setTimeout(1e3*Math.pow(2,32));return i};Plotly.prototype.getFigure=function(t,e,r){var o=this;r||(r=function(){});var s={"plotly-username":this.username,"plotly-apikey":this.apiKey,"plotly-version":this.version,"plotly-platform":this.platform};var n="/apigetfile/"+t+"/"+e;var a={host:o.host,path:n,port:o.port,headers:s,method:"GET"};var l=i.get(a,(function(t){parseRes(t,(function(t,e){try{e=JSON.parse(e)}catch(t){r(t)}if(e.error)r(e.error);else{var o=e.payload.figure;r(null,o)}}))}));l.on("error",(function(t){r(t)}));l.end()};Plotly.prototype.getImage=function(t,e,r){r=r||function(){};if(!t)return new Error("no figure provided!");var o=this;var s=JSON.stringify({figure:t,format:e.format||"png",width:e.width||700,height:e.height||500});var n={"plotly-username":o.username,"plotly-apikey":o.apiKey,"plotly-version":o.version,"plotly-platform":o.platform,"Content-Type":"application/x-www-form-urlencoded","Content-Length":s.length};var a={hostname:o.host,path:"/apigenimage/",port:o.port,headers:n,method:"POST",agent:false};function handleResponse(t){if(200!==t.statusCode){var e=new Error("Bad response status code "+t.statusCode);e.msg=t.body;return r(e,null)}r(null,t)}var l=i.request(a,handleResponse);l.on("error",(function(t){r(t)}));l.write(s);l.end()};Plotly.prototype.deletePlot=function(t,e){e||(e=function(){});var r=this;var o=new a(this.username+":"+this.apiKey).toString("base64");var s={host:"api.plot.ly",port:this.port,path:"/v2/files/"+this.username+":"+t+"/trash",method:"POST",agent:false,withCredentials:true,headers:{"Plotly-Client-Platform":"nodejs "+this.version,authorization:"Basic "+o}};var n=i.request(s,(function(t){parseRes(t,(function(r,o){if(200===t.statusCode)e(null,o);else{var s={statusCode:t.statusCode,err:o,statusMessage:t.statusMessage};e(s)}}))}));n.on("error",(function(t){e(t)}));n.end()};function parseRes(t,e){var r="";"setEncoding"in t&&t.setEncoding("utf-8");t.on("data",(function(o){r+=o;if(r.length>1e10){t.connection.destroy();t.writeHead(413,{"Content-Type":"text/plain"});t.end("req body too large");return e(new Error("body overflow"))}}));t.on("end",(function(){e(null,r)}))}var h=n;export default h;

